
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>OSM - Leaflet JS - Fablabs</title>
  <link rel="stylesheet" href="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.css" />
  <style>
    html,body{
      padding: 0;
      margin: 0;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="map" style="width: 100%; height: 100%"></div>

  <script src="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
  <script>
    (function($,L){
      var fablabs_io = new L.LayerGroup();
    
      var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
      //mbUrl = 'https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png';
      gsUrl = 'https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png';
      bwUrl = 'http://a.tile.stamen.com/toner/{z}/{x}/{y}.png';
      
      var gs   = L.tileLayer(gsUrl, {id: 'gs', attribution: mbAttr}),
          bw  = L.tileLayer(bwUrl, {id: 'bw',   attribution: mbAttr});

      var map = L.map('map', {
        center: [35, 10],
        zoom: 3,
        layers: [gs, fablabs_io]
      });

      var baseLayers = {
        /*"Grayscale": gs,
        "Black & White": bw*/
      };

      var overlays = {
        "fablabs.io": fablabs_io
      };

      L.control.layers(baseLayers, overlays).addTo(map);

      var LeafIcon = L.Icon.extend({
          options: {
              iconSize:     [35, 35],
              iconAnchor:   [17, 35],
              shadowUrl: '',
              shadowSize:   [0, 0],
              shadowAnchor: [0, 0],
              popupAnchor:  [0, -35]
          }
      });
      
      //var fablabIcon = new LeafIcon({iconUrl: 'https://www.fablabs.io/assets/map-icons/fab_lab-be48d881adead92354d745c42cd4a2de.png'});
      
      var fablabIcon = new LeafIcon({iconUrl: 'https://www.fablabs.io/assets/map-icons/fab_lab35-ee8448c7ae4fabd5567adc04e5c49751da3fc1e7da12c7ee282a2c63ce00c86a.png'});
    
      var marker_array = [];
      // https://api.fablabs.io/v0/labs.json
      $.get( "https://www.fablabs.io/labs/mapdata.json", function( data ) {
        var labs = data;//.labs;
        for(var i=0;i<labs.length;i++){
          if(labs[i].latitude!=undefined && labs[i].longitude!=undefined && labs[i].name!=undefined){
            var marker = L.marker([labs[i].latitude, labs[i].longitude], {icon: fablabIcon});
            marker.bindPopup(labs[i].name).addTo(fablabs_io);
            marker_array.push(marker);
          }
        }
      
        var group = new L.featureGroup(marker_array);
        map.fitBounds(group.getBounds());

      });
      

      /*L.marker([51.5, -0.09]).addTo(map)
          .bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
          .openPopup();*/
          
          
      /*var popup = L.popup()
        .setLatLng([51.5, -0.09])
        .setContent('<p>Hello world!<br />This is a nice popup.</p>')
        .openOn(map);*/
    })(jQuery,L);
  </script>
</body>
</html>
